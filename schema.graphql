type PaprController @entity {
  id: ID!
  createdAt: BigInt!
  # TODO watch for update pool address events
  poolAddress: Bytes!
  underlying: Bytes!
  paprToken: Bytes!
  target: BigInt!
  vaults: [Vault!] @derivedFrom(field: "controller")
  allowedCollateral: [AllowedCollateral!]! @derivedFrom(field: "controller")
  targetUpdates: [TargetUpdate!] @derivedFrom(field: "controller")
}

type Vault @entity {
  id: ID!
  account: Bytes!
  collateralContract: Bytes!
  controller: PaprController!
  debt: BigInt!
  debtPerCollateral: BigInt!
  collateral: [VaultCollateral!]! @derivedFrom(field: "vault")
  collateralCount: Int!
}

type TargetUpdate @entity {
  id: ID!
  timestamp: BigInt!
  newTarget: BigInt!
  controller: PaprController!
}

type VaultCollateral @entity {
  id: ID!
  contractAddress: Bytes!
  tokenId: BigInt!
  vault: Vault
  symbol: String!
}

type AllowedCollateral @entity {
  id: ID!
  contractAddress: Bytes!
  controller: PaprController!
  allowed: Boolean!
}

type AddCollateralEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  controller: PaprController!
  collateral: VaultCollateral!
}

type RemoveCollateralEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  controller: PaprController!
  collateral: VaultCollateral!
}

type DebtIncreasedEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  controller: PaprController!
  amount: BigInt!
}

type DebtDecreasedEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  controller: PaprController!
  amount: BigInt!
}

type Auction @entity {
  id: ID!
  startedBy: Bytes!
  endPrice: BigInt
  vault: Vault!
  nftOwner: Bytes!
  controller: PaprController!
  start: AuctionStartEvent! @derivedFrom(field: "auction")
  end: AuctionEndEvent @derivedFrom(field: "auction")
  # below are in event
  auctionAssetID: BigInt!
  auctionAssetContract: Bytes!
  perPeriodDecayPercentWad: BigInt!
  secondsInPeriod: BigInt!
  startPrice: BigInt!
  paymentAsset: Bytes!
}

type AuctionStartEvent @entity {
  id: ID!
  timestamp: Int!
  auction: Auction!
}

type AuctionEndEvent @entity {
  id: ID!
  timestamp: Int!
  auction: Auction!
}

type CollateralAllowedChangeEvent @entity {
  id: ID!
  timestamp: BigInt!
  collateralAddress: Bytes!
  controller: PaprController!
  allowed: Boolean!
}

type User @entity {
  id: ID!
  paprDebt: BigInt!
  paprHoldings: BigInt!
  phUSDCHoldings: BigInt!
  blitCount: BigInt!
  moonbirdCount: BigInt!
  toadCount: BigInt!
  dinoCount: BigInt!
}
