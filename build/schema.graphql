type LendingStrategy @entity {
  id: ID!
  createdAt: BigInt!
  name: String!
  symbol: String!
  poolAddress: Bytes!
  underlying: Bytes!
  targetAPR: BigInt!
  norm: BigInt!
  vaults: [Vault!] @derivedFrom(field: "strategy")
  allowedCollateral: [AllowedCollateral!]! @derivedFrom(field: "strategy")
  normUpdates: [NormalizationUpdate!] @derivedFrom(field: "strategy")
}

type Account @entity {
  id: ID!
  vaults: [Vault!] @derivedFrom(field: "owner")
}

type Vault @entity {
  id: ID!
  nonce: BigInt!
  strategy: LendingStrategy!
  owner: Account!
  tokenId: BigInt!
  debt: BigInt!
  totalCollateralValue: BigInt!
  collateral: [VaultCollateral!]! @derivedFrom(field: "vault")
}

type NormalizationUpdate @entity {
  id: ID!
  timestamp: BigInt!
  strategy: LendingStrategy!
  newNorm: BigInt!
}

type VaultCollateral @entity {
  id: ID!
  contractAddress: Bytes!
  tokenId: BigInt!
  value: BigInt!
  vault: Vault
}

type AllowedCollateral @entity {
  id: ID!
  contractAddress: Bytes!
  strategy: LendingStrategy
  allowed: Boolean!
}

type AddCollateralEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  strategy: LendingStrategy!
  collateral: VaultCollateral!
}

type RemoveCollateralEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  strategy: LendingStrategy!
  collateral: VaultCollateral!
}

type DebtIncreasedEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  strategy: LendingStrategy!
  amount: BigInt!
}

type DebtDecreasedEvent @entity {
  id: ID!
  timestamp: BigInt!
  vault: Vault!
  strategy: LendingStrategy!
  amount: BigInt!
}

type CollateralAllowedChangeEvent @entity {
  id: ID!
  timestamp: BigInt!
  collateralAddress: Bytes!
  strategy: LendingStrategy!
  allowed: Boolean!
}
